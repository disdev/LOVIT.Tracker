@page
@using Models
@using Utilities
@model LOVIT.Tracker.Pages.Races.IndexModel
@{
}

<div class="row">
    <div class="col">
        <h4>@Model.Race.Name</h4>
        <div class="table-responsive">
            <table id="race-leaderboard" class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th>Place</th>
                        <th>Bib</th>
                        <th scope="col">Participant</th>
                        @foreach (var segment in Model.Segments)
                        {
                            <th scope="col">@segment.TotalDistance</th>
                        }
                    </tr>
                </thead>
                <tbody>
                    @foreach (var row in Model.Leaders.Select((x, i) => new { leader = x, index = i}))
                    {
                        <tr>
                            <td>@(row.index + 1)</td>
                            <td>@row.leader.Participant.Bib</td>
                            <td>
                                <a asp-page="/participants/index" asp-route-id="@row.leader.Participant.BibOrId">@row.leader.Participant.FullName</a>
                                @if (@row.leader.Participant.Status != Status.Registered && @row.leader.Participant.Status != Status.Started)
                                {
                                    <span class="d-inline badge @row.leader.Participant.StatusClass" style="margin-left: 5px;">@row.leader.Participant.Status.ToString()</span>
                                }
                            </td>
                            @foreach (var segment in Model.Segments)
                            {
                                <td>
                                    @{
                                        var displayValue = "";
                                        var checkin = @Model.Checkins.Where(x => x.ParticipantId == row.leader.ParticipantId && x.SegmentId == segment.Id).FirstOrDefault();
                                        if (checkin != null)
                                        {
                                            displayValue = TimeHelpers.FormatTime(Model.Race.Start, checkin.When);
                                        }
                                    }
                                    @displayValue
                                </td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
<script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $('#race-leaderboard').DataTable({
            "paging": false,
            "ordering": false,
            "fixedColumns": true
        });
    });
</script>
}